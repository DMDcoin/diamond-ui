import{j as s,B as p,f as K,r as l,u as Q,d as Z,b as I,a as ss,g as es,k as as,m as ts,c as os}from"./index-en87ZZnQ.js";import{G as H,N as ns}from"./index-Cq5ZB-Us.js";import{T as A}from"./index-DjtZ4zdu.js";const is="_sectionContainer_9mhzq_1",rs="_h2Heading_9mhzq_10",ls="_daoDetailsHeading_9mhzq_17",cs="_daoDetailsContainer_9mhzq_25",ds="_proposalCreatedBy_9mhzq_35",hs="_daoDetailsFooter_9mhzq_75",ps="_payoutDetailsContainer_9mhzq_86",ms="_dismissProposalContainer_9mhzq_119",xs="_votingPhaseContainer_9mhzq_151",gs="_votingPhaseStats_9mhzq_160",us="_votingPhaseProgress_9mhzq_167",vs="_votingPhaseButtons_9mhzq_181",js="_alreadyVotedBtns_9mhzq_213",Cs="_voteForBtn_9mhzq_237",Ps="_voteAgainstBtn_9mhzq_243",_s="_ecpDetailsContainer_9mhzq_249",ys="_cupDetailsContainer_9mhzq_264",Ns="_proposalDiscussionLink_9mhzq_295",fs="_finalizedProposalContainer_9mhzq_300",Ds="_descriptionContainer_9mhzq_315",t={sectionContainer:is,h2Heading:rs,daoDetailsHeading:ls,daoDetailsContainer:cs,proposalCreatedBy:ds,daoDetailsFooter:hs,payoutDetailsContainer:ps,dismissProposalContainer:ms,votingPhaseContainer:xs,votingPhaseStats:gs,votingPhaseProgress:us,votingPhaseButtons:vs,alreadyVotedBtns:js,voteForBtn:Cs,voteAgainstBtn:Ps,ecpDetailsContainer:_s,cupDetailsContainer:ys,proposalDiscussionLink:Ns,finalizedProposalContainer:fs,descriptionContainer:Ds},Bs="_progressContainer_73gs9_1",zs="_progressLabel_73gs9_6",bs="_progressBar_73gs9_13",Vs="_progressFill_73gs9_20",Fs="_progressText_73gs9_29",v={progressContainer:Bs,progressLabel:zs,progressBar:bs,progressFill:Vs,progressText:Fs},T=({min:h,max:g,progress:j,bgColor:r})=>{const m=(Math.min(Math.max((j-h)/(g-h),0),1)*100).toFixed(2);return s.jsx("div",{className:v.progressContainer,children:s.jsxs("div",{className:v.progressBar,children:[s.jsx("div",{className:v.progressFill,style:{width:`${m}%`,backgroundColor:`${r}`}}),s.jsxs("span",{className:v.progressText,style:{left:`${m+1}%`},children:[m,"%"]})]})})};function S(h){return H({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.27 225.31c4.674-22.647.864-44.538-8.99-62.99 2.958-23.868-4.021-48.565-17.34-66.99C438.986 39.423 404.117 0 327 0c-7 0-15 .01-22.22.01C201.195.01 168.997 40 128 40h-10.845c-5.64-4.975-13.042-8-21.155-8H32C14.327 32 0 46.327 0 64v240c0 17.673 14.327 32 32 32h64c11.842 0 22.175-6.438 27.708-16h7.052c19.146 16.953 46.013 60.653 68.76 83.4 13.667 13.667 10.153 108.6 71.76 108.6 57.58 0 95.27-31.936 95.27-104.73 0-18.41-3.93-33.73-8.85-46.54h36.48c48.602 0 85.82-41.565 85.82-85.58 0-19.15-4.96-34.99-13.73-49.84zM64 296c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24zm330.18 16.73H290.19c0 37.82 28.36 55.37 28.36 94.54 0 23.75 0 56.73-47.27 56.73-18.91-18.91-9.46-66.18-37.82-94.54C206.9 342.89 167.28 272 138.92 272H128V85.83c53.611 0 100.001-37.82 171.64-37.82h37.82c35.512 0 60.82 17.12 53.12 65.9 15.2 8.16 26.5 36.44 13.94 57.57 21.581 20.384 18.699 51.065 5.21 65.62 9.45 0 22.36 18.91 22.27 37.81-.09 18.91-16.71 37.82-37.82 37.82z"},child:[]}]})(h)}function E(h){return H({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z"},child:[]}]})(h)}p.config({EXPONENTIAL_AT:1e9});const Ts=()=>{var f,D,B,z,b,V,F,q,w;const{proposalId:h}=K(),[g,j]=l.useState([]),[r,m]=l.useState({timestamp:"",vote:"",reason:""}),[e,L]=l.useState({id:"",description:"",proposer:"",state:"",timestamp:"",type:"",link:"",targets:[],values:[],calldatas:[],votes:0}),[P,M]=l.useState(""),[_,R]=l.useState(""),[W,C]=l.useState(!1),[n,G]=l.useState(),y=Q(),o=Z(),c=I(),{pools:qs,myPool:O,totalDaoStake:N}=ss(),x=l.useCallback(async a=>{c.userWallet.myAddr&&m(await o.getMyVote(a)),o.getCachedProposals().filter(d=>d.id===a).length||await o.getHistoricProposalsEvents(),a&&setTimeout(()=>{o.getProposalDetails(a).then(d=>{o.setProposalsState([d]),o.setActiveProposals(o.activeProposals.map(k=>k.id===d.id?d:k)),Y(d)})},1e3)},[o,c]),Y=l.useCallback(a=>{a?(L(a),o.setProposalsState([a]),o.getProposalVotingStats(a.id).then(i=>{G(i)}),j(o.getStateString(a.state))):l.startTransition(()=>{y("/404")}),c.showLoader(!1,"")},[o,y,c]);l.useEffect(()=>{h&&(c.showLoader(!0,"Fetching proposal details"),x(h))},[c.userWallet.myAddr,o.daoPhase]);const U=async()=>{o.dismissProposal(e.id,_).then(()=>{x(e.id)}).catch(a=>{C(!1)})},u=async a=>{var i;if(!((i=c.contractsManager.stContract)!=null&&i.methods.isPoolValid(c.userWallet.myAddr))){os.warning("Only validator candidates can vote");return}o.castVote(e.id,a,P).then(()=>{x(e.id)}).catch(d=>{})},$=async a=>{o.finalizeProposal(a).then(i=>{i==="success"&&x(a)})},X=async a=>{o.executeProposal(a).then(i=>{i==="success"&&x(a)})},J=(a,i,d)=>!!((a==="Open"||a==="Ecosystem Paramaeter Change")&&i.minus(d).isGreaterThan(33)||a==="Contract upgrade"&&i.minus(d).isGreaterThan(50));return s.jsx("section",{className:"section",children:s.jsxs("div",{className:t.sectionContainer+" sectionContainer",children:[s.jsx(ns,{start:"/dao"}),s.jsxs("div",{className:t.daoDetailsHeading,children:[s.jsxs("h4",{children:["Date: ",es(e.timestamp)]}),s.jsx("button",{children:g})]}),s.jsxs("div",{className:t.daoDetailsContainer,children:[s.jsxs("div",{children:[s.jsx("h2",{className:t.h2Heading,children:e.title}),s.jsxs("div",{className:t.proposalCreatedBy,children:[s.jsx("span",{children:"Created By: "}),s.jsx("div",{children:e.proposer})]})]}),s.jsx("div",{className:t.descriptionContainer,children:e.description}),((f=e==null?void 0:e.discussionUrl)==null?void 0:f.length)>0&&s.jsx("a",{className:t.proposalDiscussionLink,href:e.discussionUrl,rel:"noreferrer",target:"_blank",children:"Discussion Link..."}),e.proposalType==="Open"&&((D=e.targets)==null?void 0:D.length)>0&&e.targets.some(a=>a!=="0x0000000000000000000000000000000000000000")&&s.jsx("div",{className:t.payoutDetailsContainer,children:(B=e.targets)==null?void 0:B.map((a,i)=>a!=="0x0000000000000000000000000000000000000000"&&s.jsxs("div",{children:[s.jsxs("div",{children:[s.jsx("span",{children:"Payout Address"}),s.jsx("span",{children:e.targets[i]})]}),s.jsxs("div",{children:[s.jsx("span",{children:"Payout Amount"}),s.jsxs("span",{children:[new p(e.values[i]).dividedBy(10**18).toString()," DMD"]})]})]},i))}),e.proposalType==="Ecosystem Paramaeter Change"&&s.jsxs("div",{className:t.ecpDetailsContainer,children:[s.jsxs("div",{children:[s.jsx("span",{children:"Parameter"}),s.jsx("span",{children:"Gas price"})]}),s.jsxs("div",{children:[s.jsx("span",{children:"Proposed value"}),s.jsx("span",{children:as(ts(e.calldatas[0]))})]})]}),e.proposalType==="Contract upgrade"&&s.jsx("div",{className:t.cupDetailsContainer,children:(z=e.targets)==null?void 0:z.map((a,i)=>s.jsxs("div",{children:[s.jsxs("div",{children:[s.jsx("span",{children:"Target Address"}),s.jsx("span",{children:e.targets[i]})]}),s.jsxs("div",{children:[s.jsx("span",{children:"Call Data"}),s.jsx("span",{children:e.calldatas[i]})]})]},i))}),c.userWallet.myAddr===e.proposer&&e.state==="0"&&((b=o.daoPhase)==null?void 0:b.phase)==="0"&&s.jsx("div",{className:t.dismissProposalContainer,children:W?s.jsxs("div",{children:[s.jsx("input",{type:"text",placeholder:"Dismissal Reason (Optional)",value:_,onChange:a=>R(a.target.value)}),s.jsx("span",{children:"Are you sure you want to dismiss this proposal?"}),s.jsxs("div",{children:[s.jsx("button",{className:"primaryBtn",onClick:U,children:"Yes"}),s.jsx("button",{className:"primaryBtn",onClick:()=>C(!1),children:"No"})]})]}):s.jsx("button",{className:"primaryBtn",onClick:()=>C(!0),children:"Dismiss Proposal"})}),s.jsxs("div",{className:t.votingPhaseContainer,children:[(((V=o.daoPhase)==null?void 0:V.phase)!=="0"||["3","4","5","6"].includes(e.state))&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:t.votingPhaseProgress,children:[s.jsx(T,{min:0,max:100,progress:n?Number(n.positive):0,bgColor:"green"}),s.jsx(T,{min:0,max:100,progress:n?Number(n.negative):0,bgColor:"red"})]}),s.jsxs("div",{className:t.votingPhaseStats,children:[s.jsxs("div",{children:[s.jsxs("span",{children:["Positive Answers: (",n?p(n.positive).minus(n.negative).isLessThan(0)?"0.00":Math.round(p(n.positive).minus(n.negative).toNumber()):0," % exceeding | 33% required)"]}),s.jsx(A,{text:"Exceeding difference between yes and no answers | required difference"})]}),s.jsxs("div",{children:[s.jsxs("span",{children:["Participation: ",n?n.total.dividedBy(10**18).toFixed():0," DMD (",n&&N&&(n==null?void 0:n.total.dividedBy(N).multipliedBy(100).toFixed(2)),"% | 33% required)"]}),s.jsx(A,{text:"Actual % of total dao weight who participated in the voting | required % of participation"})]})]})]}),O&&e.state==="2"&&s.jsxs("div",{className:t.votingPhaseButtons,children:[r.vote!=="0"&&s.jsxs("div",{children:[r.vote==="1"&&s.jsx("div",{className:t.alreadyVotedBtns,children:s.jsx("p",{children:"You have already voted against the proposal, do you want to change your decision?"})}),r.vote==="2"&&s.jsx("div",{className:t.alreadyVotedBtns,children:s.jsx("p",{children:"You have already voted for the proposal, do you want to change your decision?"})})]}),((F=c.userWallet)==null?void 0:F.myAddr)&&s.jsx("div",{children:s.jsx("input",{type:"text",placeholder:r.reason?r.reason:"Vote Reason",value:P,onChange:a=>M(a.target.value)})}),s.jsxs("div",{children:[r.vote==="0"&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{className:t.voteForBtn,onClick:()=>u(2),children:["Vote For ",s.jsx(E,{})]}),s.jsxs("button",{className:t.voteAgainstBtn,onClick:()=>u(1),children:["Vote Against ",s.jsx(S,{})]})]}),r.vote==="1"&&s.jsx("div",{className:t.alreadyVotedBtns,children:s.jsxs("button",{className:t.voteForBtn,onClick:()=>u(2),children:["Vote For ",s.jsx(E,{})]})}),r.vote==="2"&&s.jsx("div",{className:t.alreadyVotedBtns,children:s.jsxs("button",{className:t.voteAgainstBtn,onClick:()=>u(1),children:["Vote Against ",s.jsx(S,{})]})})]})]})]}),e.state=="3"&&e.proposalType&&n&&n.positive&&n.negative&&s.jsxs("span",{className:t.finalizedProposalContainer,children:[J(e.proposalType,p(n.positive),p(n.negative))?"Proposal was approved by the community":"Proposal was not approved by the community",e.state=="3"&&r.vote!=="0"&&s.jsxs("div",{children:[r.vote==="1"&&s.jsx("div",{className:t.alreadyVotedBtns,children:s.jsx("p",{children:"You have voted against the proposal"})}),r.vote==="2"&&s.jsx("div",{className:t.alreadyVotedBtns,children:s.jsx("p",{children:"You have voted for the proposal"})})]})]}),e.state==="3"&&s.jsx("div",{className:t.finalizeProposalContainer,children:s.jsx("button",{className:"primaryBtn",onClick:()=>$(e.id),children:"Finalize Proposal"})}),["1","4","5","6"].includes(e.state)&&s.jsx("div",{className:t.finalizedProposalContainer,children:s.jsxs("span",{children:["This proposal was ",g," by the community"]})}),e.state==="4"&&o.daoPhase.daoEpoch==Number(e.daoPhaseCount)+1?s.jsx("div",{className:t.finalizeProposalContainer,children:s.jsx("button",{className:"primaryBtn",onClick:()=>X(e.id),children:"Execute Proposal"})}):e.state==="4"&&o.daoPhase.daoEpoch!=Number(e.daoPhaseCount)+1&&s.jsx("p",{children:"Proposal execution window is over"})]}),s.jsxs("div",{className:t.daoDetailsFooter,children:[((q=o.daoPhase)==null?void 0:q.phase)==="1"||!["0","1"].includes(e.state)?s.jsxs("span",{children:[e.votes," voted"]}):s.jsx("span",{}),s.jsxs("span",{children:[o.phaseEndTimer," till end of ",((w=o.daoPhase)==null?void 0:w.phase)==="1"?"Voting":"Proposal"," Phase"]})]})]})})};export{Ts as default};
