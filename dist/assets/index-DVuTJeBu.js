import{r as l,j as e,k as E,B as j,u as Q,d as ee,b as te,a as ae,l as L,c as ne}from"./index-en87ZZnQ.js";import{G as U,N as re}from"./index-Cq5ZB-Us.js";const se="_sectionContainer_1tbhk_1",oe="_proposalTypeContainer_1tbhk_5",ce="_createDaoHeading_1tbhk_12",le="_proposalType_1tbhk_5",ie="_propsalForm_1tbhk_39",de="_formInput_1tbhk_47",pe="_addRemoveTransaction_1tbhk_60",ue="_epcSelect_1tbhk_69",he="_active_1tbhk_124",me="_disabled_1tbhk_130",c={sectionContainer:se,proposalTypeContainer:oe,createDaoHeading:ce,proposalType:le,propsalForm:ie,formInput:de,addRemoveTransaction:pe,epcSelect:ue,active:he,disabled:me};function R(v){return U({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM6.75 9.25a.75.75 0 0 0 0 1.5h6.5a.75.75 0 0 0 0-1.5h-6.5Z",clipRule:"evenodd"},child:[]}]})(v)}function H(v){return U({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-11.25a.75.75 0 0 0-1.5 0v2.5h-2.5a.75.75 0 0 0 0 1.5h2.5v2.5a.75.75 0 0 0 1.5 0v-2.5h2.5a.75.75 0 0 0 0-1.5h-2.5v-2.5Z",clipRule:"evenodd"},child:[]}]})(v)}const ge="_sliderContainer_ncxtz_1",ve="_rangeInput_ncxtz_16",Ce="_valContainer_ncxtz_25",xe="_currentValue_ncxtz_33",k={sliderContainer:ge,rangeInput:ve,valContainer:Ce,currentValue:xe},fe=({contractName:v,paramsRange:s,state:i,setState:S})=>{const[_,N]=l.useState(void 0),T=l.useRef(null);l.useEffect(()=>{N(i)},[s]);const b=f=>{const d=j(f.target.value);if(_){const p=s.indexOf(_),g=p>0?s[p-1]:s[0],y=p<s.length-1?s[p+1]:s[s.length-1];d.isGreaterThan(g)&&d.isLessThan(y)?S(_.toString()):d.isLessThanOrEqualTo(g)?S(g):S(y)}},A=()=>{const f=j(i),d=j(s[0]),p=j(s[s.length-1]);return f.minus(d).dividedBy(p.minus(d)).multipliedBy(100).toFixed(2)},h=()=>{var y,C,M;const f=parseFloat(A()),d=((y=T.current)==null?void 0:y.offsetWidth)||0,p=((M=(C=T.current)==null?void 0:C.parentElement)==null?void 0:M.offsetWidth)||0;let g=f-d/p*50;return g<0&&(g=0),g>100-d/p*100&&(g=100-d/p*100),`${g}%`};return e.jsxs("div",{className:k.sliderContainer,children:[e.jsx("div",{className:k.valContainer,children:e.jsxs("span",{ref:T,className:k.currentValue,style:{left:h()},children:[i==_?"Current":"Change to",": ",e.jsx("strong",{children:v==="Block Reward"?`${i} %`:E(i)})]})}),e.jsxs("div",{children:[e.jsx("input",{type:"range",min:s[0],max:s[s.length-1],value:i,onChange:b,className:k.rangeInput}),e.jsxs("div",{className:k.valContainer,children:[e.jsxs("div",{children:[e.jsx("span",{children:"Min. "}),e.jsx("span",{children:v==="Block Reward"?`${s[0]} %`:E(s[0])})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Max. "}),e.jsx("span",{children:v==="Block Reward"?`${s[s.length-1]} %`:E(s[s.length-1])})]})]})]})]})},w={Staking:{"Delegator Min. Stake":{getter:"delegatorMinStake()",setter:"setDelegatorMinStake(uint256)",params:[],value:void 0}},"Tx Permission":{"Minimum Gas Price":{getter:"minimumGasPrice()",setter:"setMinimumGasPrice(uint256)",params:[],value:void 0},"Block Gas Limit":{getter:"blockGasLimit()",setter:"setBlockGasLimit(uint256)",params:[],value:void 0}},"Block Reward":{"Governance Pot Share Nominator":{getter:"governancePotShareNominator()",setter:"setGovernancePotShareNominator(uint256)",params:[],value:void 0}},DAO:{"Create proposal fee":{getter:"createProposalFee()",setter:"setCreateProposalFee(uint256)",params:[],value:void 0}}};j.config({EXPONENTIAL_AT:1e9});const _e=({})=>{const v=Q(),s=ee(),i=te();ae();const[S,_]=l.useState(""),[N,T]=l.useState(""),[b,A]=l.useState(""),[h,f]=l.useState("open"),[d,p]=l.useState("0"),[g,y]=l.useState([]),[C,M]=l.useState("Staking"),[B,ye]=l.useState("Delegator Min. Stake"),[V,q]=l.useState("Staking:Delegator Min. Stake:setDelegatorMinStake(uint256)"),[x,F]=l.useState([{target:"",amount:""}]),[P,I]=l.useState([{contractAddress:"",contractCalldata:""}]);l.useEffect(()=>{d==="0"&&G(C,B).then(a=>{p(a),z(C,B)})});const W=()=>{F([...x,{target:"",amount:""}])},Z=a=>{const t=[...x];t.splice(a,1),F(t)},$=(a,t,n)=>{const o=[...x];o[a][t]=n,F(o)},X=()=>{I([...P,{contractAddress:"",contractCalldata:""}])},Y=a=>{const t=[...P];t.splice(a,1),I(t)},O=(a,t,n)=>{const o=[...P];o[a][t]=n,I(o)},D=a=>{switch(a){case"DAO":return i.contractsManager.daoContract;case"Staking":return i.contractsManager.stContract;case"Certifier":return i.contractsManager.crContract;case"Validator":return i.contractsManager.vsContract;case"Tx Permission":return i.contractsManager.tpContract;case"Block Reward":return i.contractsManager.brContract;case"Connectivity Tracker":return i.contractsManager.ctContract;default:return i.contractsManager.stContract}},J=async a=>{a.preventDefault();let t=[],n=[],o=[];try{if(h==="open")x.some(r=>r.target!==""||r.amount!=="")?(t=x.map((r,m)=>{if(L(r.target))return r.target;throw new Error(`Invalid Transaction ${m+1} payout address`)}),n=x.map((r,m)=>{if(!r.amount||!(Number(r.amount)>=0))throw new Error(`Invalid Transaction ${m+1} payout amount`);return j(r.amount).multipliedBy(10**18).toString()}),o=x.map(r=>"0x")):(t=["0x0000000000000000000000000000000000000000"],n=["0"],o=["0x"]);else if(h==="contract-upgrade")t=P.map((r,m)=>{if(L(r.contractAddress))return r.contractAddress;throw new Error(`Invalid Transaction ${m+1} Contract Address`)}),n=t.map(()=>"0"),o=P.map((r,m)=>{let u=r.contractCalldata;if(!u||u.trim().length===0||u==="0x"||u==="0"||u==="0x0")throw new Error(`Invalid Transaction ${m+1} Contract Calldata`);return u});else if(h==="ecosystem-parameter-change"){let r="0x";const[,,m]=V.split(":");if(["Staking","Block Reward","Connectivity Tracker"].includes(C)&&new j(d).isNaN())throw new Error(`Invalid ${m} value`);const u=D(C),K=u==null?void 0:u.options.address;r=(u==null?void 0:u.methods)[m](d).encodeABI(),t=[K],n=["0"],o=[r]}}catch(r){return ne.error(r.message)}await s.createProposal(h,S,b,t,n,o,N).then(r=>{s.getActiveProposals().then(async()=>{if(r){const m=await s.getProposalDetails(r);s.setProposalsState([m])}}),l.startTransition(()=>{v("/dao")})}).catch(r=>{})},G=async(a,t)=>{const n=D(a);try{return n?await(n==null?void 0:n.methods)[w[a][t].getter]().call():"0"}catch{return"0"}},z=async(a,t)=>{try{const n=D(a),o=await(n==null?void 0:n.methods).getAllowedParamsRange(w[a][t].setter).call();y(o.range.length?o.range:["0","0"])}catch(n){console.log(n)}};return e.jsx("section",{className:"section",children:e.jsxs("div",{className:c.sectionContainer+" sectionContainer",children:[e.jsx(re,{start:"/dao"}),e.jsx("span",{className:c.createDaoHeading,children:"Create a Proposal"}),e.jsxs("div",{className:c.proposalTypeContainer,children:[e.jsx("label",{htmlFor:"proposalType",children:"Please choose a proposal type you want to create:"}),e.jsxs("select",{className:c.proposalType,name:"proposalType",id:"proposalType",value:h,onChange:a=>f(a.target.value),children:[e.jsx("option",{value:"open",children:"Open Proposal"}),e.jsx("option",{value:"contract-upgrade",children:"Contract upgrade"}),e.jsx("option",{value:"ecosystem-parameter-change",children:"Ecosystem parameter change"})]})]}),e.jsxs("form",{className:c.propsalForm,onSubmit:J,children:[e.jsx("input",{type:"text",className:c.formInput,value:S,onChange:a=>_(a.target.value),placeholder:"Proposal Title",required:!0}),e.jsx("input",{type:"text",className:c.formInput,value:N,onChange:a=>T(a.target.value),placeholder:"Proposal Description",required:!0}),e.jsx("input",{type:"text",className:c.formInput,value:b,onChange:a=>A(a.target.value),placeholder:"Discussion URL (optional)"}),h==="open"&&x.map((a,t)=>e.jsxs("div",{children:[e.jsxs("span",{className:c.addRemoveTransaction,onClick:()=>{t!==0&&Z(t)},children:["Transaction ",t+1,t!==0&&e.jsx(R,{size:20,color:"red"})]}),e.jsx("input",{type:"text",value:a.target,onChange:n=>$(t,"target",n.target.value),placeholder:"Payout Address (optional)",className:c.formInput}),e.jsx("input",{type:"text",value:a.amount,onChange:n=>$(t,"amount",n.target.value),placeholder:"Payout Amount (optional)",className:c.formInput})]},t)),h==="open"&&e.jsxs("span",{className:c.addRemoveTransaction,onClick:W,children:["Add Transaction",e.jsx(H,{size:20,color:"green"})]}),h==="contract-upgrade"&&P.map((a,t)=>e.jsxs("div",{children:[e.jsxs("span",{className:c.addRemoveTransaction,onClick:()=>{t!==0&&Y(t)},children:["Transaction ",t+1,t!==0&&e.jsx(R,{size:20,color:"red"})]}),e.jsx("input",{type:"text",value:a.contractAddress,onChange:n=>O(t,"contractAddress",n.target.value),placeholder:"Contract Address",className:c.formInput,required:!0}),e.jsx("input",{type:"text",value:a.contractCalldata,onChange:n=>O(t,"contractCalldata",n.target.value),placeholder:"Contract Calldata",className:c.formInput,required:!0})]},t)),h==="contract-upgrade"&&e.jsxs("span",{className:c.addRemoveTransaction,onClick:X,children:["Add Transaction",e.jsx(H,{size:20,color:"green"})]}),h==="ecosystem-parameter-change"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Please note that every parameter from the list can be changed once a month, so if there are multiple proposals for a single parameter change, the one with the highest exceeding voting power wins."}),e.jsxs("div",{children:[e.jsx("select",{className:c.epcSelect,name:"epcContractName",id:"epcContractName",value:V,onChange:async a=>{const[t,n,o]=a.target.value.split(":"),r=await G(t,n);p(r),q(`${t}:${n}:${o}`),M(t),z(t,n)},children:Object.keys(w).map(a=>e.jsx("optgroup",{label:a,children:Object.keys(w[a]).map(t=>{const n=w[a][t].setter;return e.jsx("option",{value:`${a}:${t}:${n}`,children:t},n)})},a))}),e.jsx(fe,{contractName:C,paramsRange:g,state:d,setState:p})]})]}),e.jsx("p",{children:"Please note that you pay a proposal price and a service fee when you submit a new voting creation. You can dismiss the proposal during the proposal phase, but you will lose your funds."}),e.jsx("button",{children:"Create"})]})]})})};export{_e as default};
